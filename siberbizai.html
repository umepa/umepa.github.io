<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>SiberBiz AI</title>
<style>
  body { background:#121212; color:#e0e0e0; font-family:sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; }
  .chat-container { background:#1e1e1e; border-radius:10px; width:400px; display:flex; flex-direction:column; max-width:90vw; box-shadow:0 0 20px #00d8ff66; }
  .header { background:#00d8ff; padding:15px; font-size:1.5em; color:#121212; text-align:center; }
  .messages { flex-grow:1; padding:15px; overflow-y:auto; max-height:400px; }
  .message { margin-bottom:10px; padding:10px 15px; border-radius:20px; max-width:80%; line-height:1.4; }
  .message.user { background:#00d8ff; color:#121212; align-self:flex-end; border-bottom-right-radius:5px; }
  .message.bot { background:#2a2a2a; color:#e0e0e0; align-self:flex-start; border-bottom-left-radius:5px; }
  .input-area { display:flex; border-top:1px solid #333; }
  input[type=text] { flex-grow:1; padding:15px; border:none; background:#121212; color:#e0e0e0; font-size:1em; }
  button { background:#00d8ff; border:none; padding:15px 20px; color:#121212; cursor:pointer; transition:background 0.3s ease; }
  button:hover { background:#00b1cc; }
  img.generated { max-width:100%; border-radius:10px; margin-top:10px; }
</style>
</head>
<body>
  <div class="chat-container">
    <div class="header">SiberBiz AI</div>
    <div class="messages" id="messages">
      <div class="message bot">Merhaba! Metin veya görsel üretmemi ister misin?</div>
    </div>
    <form class="input-area" onsubmit="return false;">
      <input type="text" id="userInput" placeholder="Bir şey yazın..." autocomplete="off">
      <button id="sendBtn">Gönder</button>
    </form>
  </div>

<script>
const messages = document.getElementById('messages');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const apiKey = "Bearer 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"; // Anahtar buraya

function addMessage(text, sender) {
  const div = document.createElement('div');
  div.classList.add('message', sender);
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function addImage(url) {
  const img = document.createElement('img');
  img.src = url;
  img.classList.add('generated');
  messages.appendChild(img);
  messages.scrollTop = messages.scrollHeight;
}

async function generateImage(prompt) {
  const res = await fetch("https://api.openai.com/v1/images/generations", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": apiKey
    },
    body: JSON.stringify({
      model: "dall-e-3",
      prompt: prompt,
      n: 1,
      size: "512x512"
    })
  });
  const data = await res.json();
  return data.data[0].url;
}

async function sendToOpenAI(prompt) {
  const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": apiKey
    },
    body: JSON.stringify({
      model: "gpt-4o-mini",
      messages: [{role: "user", content: prompt}]
    })
  });
  const data = await response.json();
  return data.choices[0].message.content;
}

sendBtn.addEventListener('click', async () => {
  const text = userInput.value.trim();
  if (!text) return;
  addMessage(text, "user");
  userInput.value = "";

  const loading = document.createElement("div");
  loading.classList.add("message", "bot");
  loading.textContent = "Yükleniyor...";
  messages.appendChild(loading);

  try {
    if (text.toLowerCase().includes("resim") || text.toLowerCase().includes("çiz")) {
      const imageURL = await generateImage(text);
      messages.removeChild(loading);
      addMessage("İşte oluşturduğum görsel:", "bot");
      addImage(imageURL);
    } else {
      const reply = await sendToOpenAI(text);
      messages.removeChild(loading);
      addMessage(reply, "bot");
    }
  } catch (e) {
    messages.removeChild(loading);
    addMessage("Hata oluştu: " + e.message, "bot");
  }
});

userInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") sendBtn.click();
});
</script>
</body>
</html>
